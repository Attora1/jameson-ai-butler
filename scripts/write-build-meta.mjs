// scripts/write-build-meta.mjs
// Writes public/build.json with version, commit, and timestamp at build time.

import { writeFile, mkdir } from 'node:fs/promises';
import { dirname } from 'node:path';
import { fileURLToPath } from 'node:url';

const __dirname = dirname(fileURLToPath(import.meta.url));

// Use envs if provided by Netlify/GitHub; otherwise fall back safely
const appVersion = process.env.APP_VERSION || '0.1.0';
const commit = process.env.COMMIT_REF || process.env.GITHUB_SHA || 'local';
const buildTime = new Date().toISOString();

const payload = {
  appName: 'AELI',
  appVersion,
  buildTime,
  commit,
  notes: 'auto-generated by write-build-meta.mjs',
};

await mkdir(`${__dirname}/../public`, { recursive: true });
await writeFile(`${__dirname}/../public/build.json`, JSON.stringify(payload, null, 2));

console.log('[build-meta] wrote public/build.json:', payload);